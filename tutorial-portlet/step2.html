<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.3">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Step 2 - Viewing and posting Secret</title>
<link rel="stylesheet" href="./rocket-panda.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.1.0/css/font-awesome.min.css">
<style>
.CodeRay {
  background-color: hsl(0,0%,95%);
  border: 1px solid silver;
  color: black;
}
.CodeRay pre {
  margin: 0px;
}

span.CodeRay { white-space: pre; border: 0px; padding: 2px; }

table.CodeRay { border-collapse: collapse; width: 100%; padding: 2px; }
table.CodeRay td { padding: 2px 4px; vertical-align: top; }

.CodeRay .line-numbers {
  background-color: hsl(180,65%,90%);
  color: gray;
  text-align: right;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
}
.CodeRay .line-numbers a {
  background-color: hsl(180,65%,90%) !important;
  color: gray !important;
  text-decoration: none !important;
}
.CodeRay .line-numbers a:target { color: blue !important; }
.CodeRay .line-numbers .highlighted { color: red !important; }
.CodeRay .line-numbers .highlighted a { color: red !important; }
.CodeRay span.line-numbers { padding: 0px 4px; }
.CodeRay .line { display: block; float: left; width: 100%; }
.CodeRay .code { width: 100%; }

.CodeRay .debug { color: white !important; background: blue !important; }

.CodeRay .annotation { color:#007 }
.CodeRay .attribute-name { color:#b48 }
.CodeRay .attribute-value { color:#700 }
.CodeRay .binary { color:#509 }
.CodeRay .char .content { color:#D20 }
.CodeRay .char .delimiter { color:#710 }
.CodeRay .char { color:#D20 }
.CodeRay .class { color:#B06; font-weight:bold }
.CodeRay .class-variable { color:#369 }
.CodeRay .color { color:#0A0 }
.CodeRay .comment { color:#777 }
.CodeRay .comment .char { color:#444 }
.CodeRay .comment .delimiter { color:#444 }
.CodeRay .complex { color:#A08 }
.CodeRay .constant { color:#036; font-weight:bold }
.CodeRay .decorator { color:#B0B }
.CodeRay .definition { color:#099; font-weight:bold }
.CodeRay .delimiter { color:black }
.CodeRay .directive { color:#088; font-weight:bold }
.CodeRay .doc { color:#970 }
.CodeRay .doc-string { color:#D42; font-weight:bold }
.CodeRay .doctype { color:#34b }
.CodeRay .entity { color:#800; font-weight:bold }
.CodeRay .error { color:#F00; background-color:#FAA }
.CodeRay .escape  { color:#666 }
.CodeRay .exception { color:#C00; font-weight:bold }
.CodeRay .float { color:#60E }
.CodeRay .function { color:#06B; font-weight:bold }
.CodeRay .global-variable { color:#d70 }
.CodeRay .hex { color:#02b }
.CodeRay .imaginary { color:#f00 }
.CodeRay .include { color:#B44; font-weight:bold }
.CodeRay .inline { background-color: hsla(0,0%,0%,0.07); color: black }
.CodeRay .inline-delimiter { font-weight: bold; color: #666 }
.CodeRay .instance-variable { color:#33B }
.CodeRay .integer  { color:#00D }
.CodeRay .key .char { color: #60f }
.CodeRay .key .delimiter { color: #404 }
.CodeRay .key { color: #606 }
.CodeRay .keyword { color:#080; font-weight:bold }
.CodeRay .label { color:#970; font-weight:bold }
.CodeRay .local-variable { color:#963 }
.CodeRay .namespace { color:#707; font-weight:bold }
.CodeRay .octal { color:#40E }
.CodeRay .operator { }
.CodeRay .predefined { color:#369; font-weight:bold }
.CodeRay .predefined-constant { color:#069 }
.CodeRay .predefined-type { color:#0a5; font-weight:bold }
.CodeRay .preprocessor { color:#579 }
.CodeRay .pseudo-class { color:#00C; font-weight:bold }
.CodeRay .regexp .content { color:#808 }
.CodeRay .regexp .delimiter { color:#404 }
.CodeRay .regexp .modifier { color:#C2C }
.CodeRay .regexp { background-color:hsla(300,100%,50%,0.06); }
.CodeRay .reserved { color:#080; font-weight:bold }
.CodeRay .shell .content { color:#2B2 }
.CodeRay .shell .delimiter { color:#161 }
.CodeRay .shell { background-color:hsla(120,100%,50%,0.06); }
.CodeRay .string .char { color: #b0b }
.CodeRay .string .content { color: #D20 }
.CodeRay .string .delimiter { color: #710 }
.CodeRay .string .modifier { color: #E40 }
.CodeRay .string { background-color:hsla(0,100%,50%,0.05); }
.CodeRay .symbol .content { color:#A60 }
.CodeRay .symbol .delimiter { color:#630 }
.CodeRay .symbol { color:#A60 }
.CodeRay .tag { color:#070 }
.CodeRay .type { color:#339; font-weight:bold }
.CodeRay .value { color: #088; }
.CodeRay .variable  { color:#037 }

.CodeRay .insert { background: hsla(120,100%,50%,0.12) }
.CodeRay .delete { background: hsla(0,100%,50%,0.12) }
.CodeRay .change { color: #bbf; background: #007; }
.CodeRay .head { color: #f8f; background: #505 }
.CodeRay .head .filename { color: white; }

.CodeRay .delete .eyecatcher { background-color: hsla(0,100%,50%,0.2); border: 1px solid hsla(0,100%,45%,0.5); margin: -1px; border-bottom: none; border-top-left-radius: 5px; border-top-right-radius: 5px; }
.CodeRay .insert .eyecatcher { background-color: hsla(120,100%,50%,0.2); border: 1px solid hsla(120,100%,25%,0.5); margin: -1px; border-top: none; border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; }

.CodeRay .insert .insert { color: #0c0; background:transparent; font-weight:bold }
.CodeRay .delete .delete { color: #c00; background:transparent; font-weight:bold }
.CodeRay .change .change { color: #88f }
.CodeRay .head .head { color: #f4f }

</style>
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-1292368-37', 'juzuweb.org');
    ga('send', 'pageview');

</script>
</head>
<body class="book toc2">
<div id="header">
<h1>Step 2 - Viewing and posting Secret</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ol type="none" class="sectlevel0">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_create_my_model">Create my model</a></li>
<li>
<ol type="none" class="sectlevel1">
<li><a href="#_secret">Secret</a></li>
</ol>
</li>
<li><a href="#_create_my_service">Create my service</a></li>
<li>
<ol type="none" class="sectlevel1">
<li><a href="#_secret_service_interface">Secret Service Interface</a></li>
<li><a href="#_secret_service_implementation">Secret Service Implementation</a></li>
</ol>
</li>
<li><a href="#_display_secrets">Display Secrets</a></li>
<li>
<ol type="none" class="sectlevel1">
<li><a href="#_binding_application_bean">Binding Application Bean</a></li>
<li><a href="#_scoped_binding">Scoped Binding</a></li>
<li><a href="#_abstract_bean_binding">Abstract Bean Binding</a></li>
<li><a href="#_develop_the_controller">Develop the controller</a></li>
<li><a href="#_type_safe_parameters">Type safe parameters</a></li>
<li><a href="#_default_controller_method">Default controller method</a></li>
<li><a href="#_display_secret">Display Secret</a></li>
<li><a href="#_juzu_templating">Juzu templating</a></li>
<li><a href="#_see_the_secret_list">See the secret list</a></li>
</ol>
</li>
<li><a href="#_add_secret">Add Secret</a></li>
<li>
<ol type="none" class="sectlevel1">
<li><a href="#_template">Template</a></li>
<li><a href="#_view">View</a></li>
<li><a href="#_action">Action</a></li>
</ol>
</li>
<li><a href="#_redirection">Redirection</a></li>
</ol>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>From the step 1 you learn how to start a simple Juzu project and deploy it in eXo Platform.<br>
Here we will start to play with Juzu and add some functionality to our application.</p>
</div>

</div>
</div>
<h1 id="_introduction" class="sect0"><a class="anchor" href="#_introduction"></a>Introduction</h1>
<div class="paragraph">
<p>It&#8217;s time to tell you a little bit more about <strong>JuZcret application</strong>.<br>
First of all we have secret. A secret is a <strong>simple message</strong> but it can also be enliven by an <strong>image</strong> (to better illustrate the secret).<br>
Our application will manage a list of secrets and display them. Of course any user can <strong>share</strong> also their secrets using an <strong>add</strong> secret button.<br>
In the future, connected users will also have the possibility to <strong>like and comment secrets</strong>, but it&#8217;s not include in the Step 2.</p>
</div>

<h1 id="_create_my_model" class="sect0"><a class="anchor" href="#_create_my_model"></a>Create my model</h1>
<div class="paragraph">
<p>Here no Juzu Stuff, we will just create a <strong>simple Secret bean</strong> containing a default constructor with getters and setters.<br>
In <code>org.juzu.tutorial</code> package, add a new package named <code>models</code>. In this new package create a <strong>Secret class</strong> as below:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/step2/models-package.png" alt="Models package" width="300">
</div>

</div>
<div class="sect1">
<h2 id="_secret"><a class="anchor" href="#_secret"></a>Secret</h2>
<div class="sectionbody">
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">org.juzu.tutorial.models</span>;

<span class="keyword">import</span> <span class="include">java.io.Serializable</span>;
<span class="keyword">import</span> <span class="include">java.util.Date</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Secret</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

   <span class="directive">private</span> <span class="predefined-type">String</span> message;

   <span class="directive">private</span> <span class="predefined-type">String</span> imageURL;

   <span class="directive">private</span> <span class="predefined-type">Date</span> createdDate;

   <span class="directive">public</span> Secret() {}

   <span class="directive">public</span> <span class="predefined-type">String</span> getMessage() { <span class="keyword">return</span> message; }

   <span class="directive">public</span> <span class="type">void</span> setMessage(<span class="predefined-type">String</span> message) { <span class="local-variable">this</span>.message = message; }

   <span class="directive">public</span> <span class="predefined-type">String</span> getImageURL() { <span class="keyword">return</span> imageURL; }

   <span class="directive">public</span> <span class="type">void</span> setImageURL(<span class="predefined-type">String</span> imageURL) { <span class="local-variable">this</span>.imageURL = imageURL; }

   <span class="directive">public</span> <span class="predefined-type">Date</span> getCreatedDate() { <span class="keyword">return</span> createdDate; }

   <span class="directive">public</span> <span class="type">void</span> setCreatedDate(<span class="predefined-type">Date</span> createdDate) { <span class="local-variable">this</span>.createdDate = createdDate; }
}</code></pre>
</div>
</div>

</div>
</div>

<h1 id="_create_my_service" class="sect0"><a class="anchor" href="#_create_my_service"></a>Create my service</h1>
<div class="paragraph">
<p>We need to create an application bean to manage all the secrets: <strong>The SecretService !</strong><br>
The SecretService will contains all the logic of our application, like getting the list of secrets or adding secret.</p>
</div>
<div class="paragraph">
<p>In <strong>org.juzu.tutorial</strong> package, add a new package named <code>services</code>. In this new package create the interface <code>SecretService</code> and its implementation <code>SecretServiceMemImpl</code> as below:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/step2/services-package.png" alt="Services package" width="300">
</div>

</div>
<div class="sect1">
<h2 id="_secret_service_interface"><a class="anchor" href="#_secret_service_interface"></a>Secret Service Interface</h2>
<div class="sectionbody">
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">org.juzu.tutorial.services</span>;

<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="keyword">import</span> <span class="include">org.juzu.tutorial.models.Secret</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">SecretService</span> {

    <span class="predefined-type">List</span>&lt;Secret&gt; getSecrets();

    <span class="type">void</span> addSecret(<span class="predefined-type">String</span> message, <span class="predefined-type">String</span> imageUrl);
}</code></pre>
</div>
</div>

</div>
</div>
<div class="sect1">
<h2 id="_secret_service_implementation"><a class="anchor" href="#_secret_service_implementation"></a>Secret Service Implementation</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">

In the step-2 we will implement a simple in-memory data saving implementation for simplicity. Real persistence is only for real aspirant Juzu developer not for rookie ;) and will be cover later in step-5.
</td>
</tr>
</table>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">org.juzu.tutorial.services</span>;

<span class="keyword">import</span> <span class="include">org.juzu.tutorial.models.Secret</span>;

<span class="keyword">import</span> <span class="include">java.util.Date</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SecretServiceMemImpl</span> <span class="directive">implements</span> SecretService {

    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Secret&gt; secretsList;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Secret&gt; getSecrets() {
    <span class="keyword">return</span> secretsList;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> addSecret(<span class="predefined-type">String</span> message, <span class="predefined-type">String</span> imageUrl) {
    Secret secret = <span class="keyword">new</span> Secret();
    secret.setMessage(message);
    secret.setImageURL(imageUrl);
    secret.setCreatedDate(<span class="keyword">new</span> <span class="predefined-type">Date</span>());
    secretsList.add(secret);
    }
}</code></pre>
</div>
</div>

</div>
</div>

<h1 id="_display_secrets" class="sect0"><a class="anchor" href="#_display_secrets"></a>Display Secrets</h1>
<div class="paragraph">
<p>Now that our <code>SecretService</code> Application Bean is ready we would like to use it.<br>
But before, we need to declare it. And declare custom bean in Juzu is a very simple task.</p>
</div>
<div class="sect1">
<h2 id="_binding_application_bean"><a class="anchor" href="#_binding_application_bean"></a>Binding Application Bean</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Remember step 1, I told you about a configuration file of our application named <code>package-info.java</code>.<br>
This java file is a home for <strong>package level annotation</strong>. This is where we will declare our new Application Bean. Replace the <code>package-info.java</code> with:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@juzu</span>.Application
<span class="annotation">@Bindings</span>({
        <span class="annotation">@Binding</span>(value = org.juzu.tutorial.services.SecretService.class, implementation = org.juzu.tutorial.services.SecretServiceMemImpl.class, scope = Scope.SINGLETON)
})
<span class="keyword">package</span> <span class="namespace">org.juzu.tutorial</span>;

<span class="keyword">import</span> <span class="include">juzu.Scope</span>;
<span class="keyword">import</span> <span class="include">juzu.plugin.binding.Binding</span>;
<span class="keyword">import</span> <span class="include">juzu.plugin.binding.Bindings</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a Juzu application we have several kind of beans: <strong>controllers, template, plugins, application services</strong> (Don&#8217;t worry each of this list will be covered in different step).<br>
All this different beans are <strong>container managed</strong>. It means that this is the job of the <strong>IOC container</strong> to manage the service lifecycle (instantiation, inject dependencies&#8230;) and inject it where you need it.<br>
For instance you can directly inject and use a template in a controller by adding the <strong>@Inject annotation</strong> when you declare it:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Inject</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">index.gtmpl</span><span class="delimiter">&quot;</span></span>)
Template index;</code></pre>
</div>
</div>
<div class="paragraph">
<p>However if you want to use a custom bean like our <code>SecretService</code> you need first to declare it in the <code>package-info.java</code> using the <strong>@Binding annotation</strong>.<br>
And that&#8217;s it. Now we can use the <code>SecretService</code> anywhere in our application simply by using the <strong>@Inject annotation</strong>.</p>
</div>

</div>
</div>
<div class="sect1">
<h2 id="_scoped_binding"><a class="anchor" href="#_scoped_binding"></a>Scoped Binding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s time for lesson! Let&#8217;s talk a little bit about <strong>scoped binding in Juzu</strong>.<br>
As you see, we declared our service as a <strong>singleton</strong>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java">scope = Scope.SINGLETON</code></pre>
</div>
</div>
<div class="paragraph">
<p>By declaring my <strong>Service bean</strong> as a <strong>Singleton</strong> in <code>package-info.java</code>, I override the <strong>scope annotation</strong> the bean could declare.<br>
The annotation scope is optional in <code>package-info.java</code>. If the scope is not specified, the scope is determined from the bean that should be annotated with a scope annotation.<br>
For instance in our case, declaring in <code>package-info.java</code></p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Bindings</span>({
        <span class="annotation">@Binding</span>(value = org.juzu.tutorial.services.SecretService.class, implementation = org.juzu.tutorial.services.SecretServiceMemImpl.class, scope = Scope.SINGLETON)
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will give us the exact same result that declaring in <code>package-info.java</code></p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Bindings</span>({
        <span class="annotation">@Binding</span>(value = org.juzu.tutorial.services.SecretService.class, implementation = org.juzu.tutorial.services.SecretServiceMemImpl.class)
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>and add in <code>SecretServiceMemImpl</code> the <strong>@Singletion annotation</strong>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SecretServiceMemImpl</span> <span class="directive">implements</span> SecretService {

...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add scope in <code>package-info.java</code> it&#8217;s recommended. It&#8217;s a more fine grained way and enable you by opening <code>package-info.java</code> to have a quick overview of the composition of your project.</p>
</div>

</div>
</div>
<div class="sect1">
<h2 id="_abstract_bean_binding"><a class="anchor" href="#_abstract_bean_binding"></a>Abstract Bean Binding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s have another talk about <strong>abstract bean binding</strong> in Juzu.<br>
In our example we need to set the <strong>implementation member</strong> of the <code>@Binding</code> annotation because <code>SecretService</code> is an interface.<br>
In case your <strong>Application Bean</strong> doesn&#8217;t have an interface, you don&#8217;t need to set the implementation member. For instance in our case we may directly use the implementation:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Bindings</span>({
        <span class="annotation">@Binding</span>(value = org.juzu.tutorial.services.SecretServiceImpl.class, scope = Scope.SINGLETON)
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ok that&#8217;s all for explanation, we go back to the code.</p>
</div>

</div>
</div>
<div class="sect1">
<h2 id="_develop_the_controller"><a class="anchor" href="#_develop_the_controller"></a>Develop the controller</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We already develop a new Application Bean: <code>SecrectService</code> and we declared it in <code>package-info.java</code>. Now it&#8217;s time to use it with a <strong>new Controller</strong> named <strong>JuZcretApplication</strong> which will allow us to display the secret list.<br>
In <code>org.juzu.tutorial</code> package create a new java class <code>JuZcretApplication</code>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">org.juzu.tutorial</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">JuZcretApplication</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>JuZcretApplication Controller Bean</strong> must be the <strong>default Controller</strong> of our application. Right now we have two Controllers beans in our project:</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p><code>Controller.java</code></p>
</li>
<li>
<p><code>JuZcretApplication.java</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>No problem with this, you can <strong>use as many controllers you want with Juzu</strong>. But (always a but..) you need to tell Juzu which one is the <strong>default Controller</strong>.<br>
Guess where we will define this ? Yes, <code>package-info.java</code> !<br>
Open it and just update the <strong>@Application annotation</strong> by setting the <strong>defaultController member</strong>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@juzu</span>.Application(defaultController = org.juzu.tutorial.JuZcretApplication.class)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To display the secret list, our <code>JuZcretApplication</code> controller need:</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>The <code>SecretService</code> Application Bean</p>
</li>
<li>
<p>A new template able to display a list of secret</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Create a new empty template <code>secretWall.gtmpl</code> in <code>org.juzu.tutorial.templates</code> package. The <strong>secretWall template</strong> will be responsible to <strong>display the list of secrets</strong>.<br>
Create also another empty template <code>addSecret.gtmpl</code> in <code>org.juzu.tutorial.templates</code> package:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/step2/templates-package.png" alt="Templates package" width="300">
</div>

</div>
<div class="paragraph">
<p>The <strong>addSecret template</strong> will be responsible to <strong>display the form to add a new secret</strong>.</p>
</div>
<div class="paragraph">
<p>We need to inject in JuZcretApplication, our Application bean and our Template beans:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">org.juzu.tutorial</span>;

<span class="keyword">import</span> <span class="include">juzu.Path</span>;
<span class="keyword">import</span> <span class="include">org.juzu.tutorial.services.SecretService</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">JuZcretApplication</span> {

    <span class="annotation">@Inject</span>
    SecretService secretService;

    <span class="annotation">@Inject</span>
    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">secretWall.gtmpl</span><span class="delimiter">&quot;</span></span>)
    org.juzu.tutorial.templates.secretWall secretWall;

    <span class="annotation">@Inject</span>
    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">addSecret.gtmpl</span><span class="delimiter">&quot;</span></span>)
    org.juzu.tutorial.templates.addSecret addSecret;

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">

<div class="paragraph">
<p>If you encounter a <code>cannot resolve symbol</code> exception after injecting a new created template like this:</p>
</div>
<div class="imageblock" style="text-align: left">
<div class="content">
<img src="images/step2/template-issue.png" alt="Template Issue" width="400">
</div>

</div>
<div class="paragraph">
<p>you should recompile your project:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="html language-html">$ mvn clean compile</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will generate the java class associate to this template and consequently fix the <code>cannot resolve symbol</code> exception.</p>
</div>

</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we need to create a <strong>new View Controller</strong>. A View Controller is a method with the <strong>@View annotation</strong> responsible to <strong>provide markup</strong>. The <code>@View</code> will use an injected template to create markup. The <code>@View</code> method delegates the rendering to the Template.<br>
In our case we will create a new <strong>View Controller</strong> responsible to provide the display of the secret list.</p>
</div>

</div>
</div>
<div class="sect1">
<h2 id="_type_safe_parameters"><a class="anchor" href="#_type_safe_parameters"></a>Type safe parameters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a template you can declare some <strong>parameters</strong> which will be <strong>directly available on a subclass</strong> of the <code>juzu.template.Template</code> class.<br>
For instance, open <code>secretWall.gtmpl</code> and add:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="html language-html">#{param name=secretsList/}
Here is my secret list:
${secretsList}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>#{param name=secretsList/}</code> declare the parameter secretsList
</p>
</div>
<div class="paragraph">
<p>Now add the View in JuZcretApplication.java like below:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">juzu.Response</span>;
<span class="keyword">import</span> <span class="include">juzu.View</span>;

...

   <span class="annotation">@View</span>
   <span class="directive">public</span> Response.Content index() {
       <span class="keyword">return</span> secretWall.with().secretsList(<span class="string"><span class="delimiter">&quot;</span><span class="content">My list of secret</span><span class="delimiter">&quot;</span></span>).ok();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You see that we can directly set the parameter secretsList declared in the secretWall template via a <strong>generated method</strong> named by the <strong>parameter name</strong>. For the secretsList parameter <code>#{param name=secretsList/}</code> we have a <code>secretsList()</code> method that can be used.</p>
</div>
<div class="paragraph">
<p>Consequently if you modify <code>secretWall.gtmpl</code> template and change the name of the parameter <code>secretList</code>, the <strong>compilation</strong> of JuZcretApplication.java will <strong>failed</strong>.</p>
</div>
<div class="paragraph">
<p>Declare parameter in the template and use generated method in the controller is not mandatory. You can simply use an <strong>HashMap</strong> to store parameters passed by the controller to the template:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@View</span>
<span class="directive">public</span> Response.Content index() {
    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; parameters = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;();
    parameters.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">secretsList</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">My list of secret</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">return</span> secretWall.with(parameters).ok();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>But using <strong>HashMap</strong> means that if a template <strong>parameter name changes</strong>, the controller will continue to <strong>compile without error</strong> because of the generic parameter map. To avoid such situation and see the error only on running, it&#8217;s better to declare parameter in the template and use the generated method named by the parameter name.</p>
</div>

</div>
</div>
<div class="sect1">
<h2 id="_default_controller_method"><a class="anchor" href="#_default_controller_method"></a>Default controller method</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One more thing. In Juzu, <strong>index</strong> is a special name that <strong>catches any unmatched request</strong>. In other word, the method <strong>index()</strong> annotated with <code>@View</code> provide the <strong>default markup</strong> of our application.</p>
</div>

</div>
</div>
<div class="sect1">
<h2 id="_display_secret"><a class="anchor" href="#_display_secret"></a>Display Secret</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">

Please <a href="http://community.exoplatform.com/portal/g/:spaces:juzu/juzu/wiki/Develop_Juzu_Portlet_with_JRebel" target="_blank">configure now your project to use JRebel</a>. This will allow hot redeployment of our Portlet without restarting the server.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Recompile the project:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="text language-text">$ mvn clean install</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy/Paste the war <em>(replace the old one)</em> in the webapp folder of PLF server as explain in step 1, start the server and open <a href="http://localhost:8080/portal/intranet/JuZcret" target="_blank">JuZcret page created in step 1</a>.<br>
It display you the simple <strong>My list of secret</strong> message:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/step2/my-list-of-secret.png" alt="My list of secret" width="800">
</div>

</div>
<div class="paragraph">
<p>What we really want is to get the list of secrets and display it. Not display a single hard coded sentence.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">

Remember that we just have configured the portlet to use JRebel. So from now <strong>don&#8217;t need to restart the server</strong> after modification, just rebuild using <code>mvn clean compile</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In <code>JuZcretApplication.java</code> modify the index method to pass a list of secret to the <code>secretWall</code> template instead of a String:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java">   <span class="annotation">@View</span>
   <span class="directive">public</span> Response.Content index() {
       <span class="keyword">return</span> secretWall.with().secretsList(secretService.getSecrets()).ok();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>SecretServiceMemImpl.java</code> we will initiate the secret list with some fake secrets to have some default secrets to display for our test:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">java.util.LinkedList</span>;

...

public <span class="type">class</span> <span class="class">SecretServiceMemImpl</span> <span class="directive">implements</span> SecretService {

  <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Secret&gt; secretsList;

  <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Secret&gt; getSecrets() {
    <span class="keyword">if</span> (secretsList == <span class="predefined-constant">null</span>) {
      secretsList = <span class="keyword">new</span> <span class="predefined-type">LinkedList</span>&lt;Secret&gt;();
      addFakeSecrets();
    }
    <span class="keyword">return</span> secretsList;
   }

...

  private <span class="type">void</span> addFakeSecrets() {
     addSecret(<span class="string"><span class="delimiter">&quot;</span><span class="content">Yesterday I said I missed my PL meeting because I have to many work. In fact I was drinking free beer in Barbetta pub</span><span class="delimiter">&quot;</span></span>,
              <span class="string"><span class="delimiter">&quot;</span><span class="content">https://c1.staticflickr.com/3/2385/2345543856_6d0fbafb66_z.jpg?zz=1</span><span class="delimiter">&quot;</span></span>);
     addSecret(<span class="string"><span class="delimiter">&quot;</span><span class="content">I have a master degree but I still use Google to calculate 3*8</span><span class="delimiter">&quot;</span></span>,
              <span class="string"><span class="delimiter">&quot;</span><span class="content">https://yy2.staticflickr.com/7244/7245177220_3f17ee9fb8_z.jpg</span><span class="delimiter">&quot;</span></span>);
     addSecret(<span class="string"><span class="delimiter">&quot;</span><span class="content">I am in relationship for 2 years. He is awesome, powerful and I never go out without him. His name is Linux</span><span class="delimiter">&quot;</span></span>,
              <span class="string"><span class="delimiter">&quot;</span><span class="content">http://fc02.deviantart.net/fs71/f/2009/364/9/d/christmas_love_by_skubaNiec.jpg</span><span class="delimiter">&quot;</span></span>);
     addSecret(<span class="string"><span class="delimiter">&quot;</span><span class="content">I spent 2 hours a day to train my cat to perform a backflip</span><span class="delimiter">&quot;</span></span>,
              <span class="string"><span class="delimiter">&quot;</span><span class="content">http://fc06.deviantart.net/fs15/i/2007/008/e/b/colour_cat_wallpaper_by_jellyplant.jpg</span><span class="delimiter">&quot;</span></span>);
     addSecret(<span class="string"><span class="delimiter">&quot;</span><span class="content">I pretend to be a spy when I go out. In reality my job is to perform photocopy at the embassy</span><span class="delimiter">&quot;</span></span>,
              <span class="string"><span class="delimiter">&quot;</span><span class="content">https://c2.staticflickr.com/2/1230/5108154392_3cc02cac67_z.jpg</span><span class="delimiter">&quot;</span></span>);
   }
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally we need to update the <code>secretWall.gtmpl</code> template to manage the secret list passed by the controller and <strong>display all secrets</strong>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="html language-html">#{param name=secretsList/}

<span class="tag">&lt;ul</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret-wall-list</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="error">&lt;</span>% secretsList.each { secret -<span class="error">&gt;</span> %<span class="error">&gt;</span>
    <span class="tag">&lt;li&gt;</span>
        ${secret.message}
    <span class="tag">&lt;/li&gt;</span>
<span class="error">&lt;</span>% } %<span class="error">&gt;</span>
<span class="tag">&lt;/ul&gt;</span></code></pre>
</div>
</div>

</div>
</div>
<div class="sect1">
<h2 id="_juzu_templating"><a class="anchor" href="#_juzu_templating"></a>Juzu templating</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>native Juzu template engine</strong> extends the <strong>Groovy templating system</strong> so we can include <strong>snippet</strong> of Groovy code or resolve Groovy <strong>expressions</strong>.<br>
In our case, we use Groovy code with the scriptlet syntax <code>&lt;% &#8230; %&gt;</code> to perform a simple loop on each secret. Then each secret is added in a <code>&lt;li&gt;</code> tag using Groovy expressions wrapped with the <code>${&#8230;}</code> syntax.</p>
</div>

</div>
</div>
<div class="sect1">
<h2 id="_see_the_secret_list"><a class="anchor" href="#_see_the_secret_list"></a>See the secret list</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now rebuild our project, then refresh browser, and here is the result:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/step2/list-of-hardcoded-secret.png" alt="list-of-hardcoded-secret" width="800">
</div>

</div>
<div class="paragraph">
<p>You&#8217;ll see in the server log something like this:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="text language-text">JRebel: Reloading class 'org.juzu.tutorial.JuZcretApplication'.
JRebel: Reloading class 'org.juzu.tutorial.templates.secretWall'.
JRebel: Reloading class 'org.juzu.tutorial.services.SecretService'.
JRebel: Reloading class 'org.juzu.tutorial.models.Secret'</code></pre>
</div>
</div>
<div class="paragraph">
<p>JRebel reloads the classes, and save us from restarting tomcat server. But keep in mind that it can only reload class, it can&#8217;t renew object instance. That means that <strong>attributes of created object</strong> stay the same after its class has been reloaded.</p>
</div>

</div>
</div>

<h1 id="_add_secret" class="sect0"><a class="anchor" href="#_add_secret"></a>Add Secret</h1>
<div class="paragraph">
<p>We are <strong>close to the end !</strong> After displaying the secrets, we want to add a new secret.<br>
We already have a service ready for that with the <code>addSecret</code> method:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Override</span>
 <span class="directive">public</span> <span class="type">void</span> addSecret(<span class="predefined-type">String</span> message, <span class="predefined-type">String</span> imageUrl) {
      Secret secret = <span class="keyword">new</span> Secret();
      secret.setMessage(message);
      secret.setImageURL(imageUrl);
      secret.setCreatedDate(<span class="keyword">new</span> <span class="predefined-type">Date</span>());
      secretsList.add(secret);
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>What is missing is a <strong>form to create a new secret</strong> and the logic to manage it. Below is the list of what we need:</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Update the <code>secretWall.gtmpl</code> template to be able to add a secret</p>
</li>
<li>
<p>Update the <code>addSecret.gtmpl</code> template to display an add secret form</p>
</li>
<li>
<p>Create a new view Controller to provide markup to create secret using the <code>addSecret.gtmpl</code> template</p>
</li>
<li>
<p>Add Some logic to switch between the different view and manage the add secret feature</p>
</li>
</ol>
</div>
<div class="sect1">
<h2 id="_template"><a class="anchor" href="#_template"></a>Template</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We need to add a link in the <code>secretWall.gtmpl</code> to switch to the add secret form:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="html language-html">#{param name=secretsList/}

<span class="tag">&lt;ul</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret-wall-list</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="error">&lt;</span>% secretsList.each { secret -<span class="error">&gt;</span> %<span class="error">&gt;</span>
    <span class="tag">&lt;li&gt;</span>
        ${secret.message}
    <span class="tag">&lt;/li&gt;</span>
<span class="error">&lt;</span>% } %<span class="error">&gt;</span>
<span class="tag">&lt;/ul&gt;</span>
<span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">button</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Share my secret<span class="tag">&lt;/a&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For now we keep the href empty, we will come back later on it.</p>
</div>
<div class="paragraph">
<p>Then we need to update the <code>addSecret.gtmpl</code> template for display an add secret form:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="html language-html"><span class="tag">&lt;form</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h5&gt;</span>Share my secret<span class="tag">&lt;/h5&gt;</span>
    My secret:
    <span class="tag">&lt;textarea</span> <span class="attribute-name">rows</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">msg</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">placeholder</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Write your secret here</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/textarea&gt;</span>
    <span class="tag">&lt;br</span><span class="tag">/&gt;</span>
    Image URL:
    <span class="tag">&lt;input</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">imgURL</span><span class="delimiter">&quot;</span></span>  <span class="attribute-name">placeholder</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://upload.wikimedia.org/wikipedia/commons/e/ee/Karl_Witkowski_-_Secrets.jpg</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;br</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Share<span class="tag">&lt;/button&gt;</span>
<span class="tag">&lt;/form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For both href and action parameters we keep the value empty, we will come back later on it.</p>
</div>

</div>
</div>
<div class="sect1">
<h2 id="_view"><a class="anchor" href="#_view"></a>View</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We need to create a new View Controller to provide markup for adding a new secret in <code>JuZcretApplication.java</code><br>
We already inject at the beginning of the this step, the new template <code>addSecret</code>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Inject</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">addSecret.gtmpl</span><span class="delimiter">&quot;</span></span>)
org.juzu.tutorial.templates.addSecret addSecret;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we need to create the View method <code>addSecretForm()</code>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java">   <span class="annotation">@View</span>
   <span class="directive">public</span> Response.Content addSecretForm() {
       <span class="keyword">return</span> addSecret.ok();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Come back to <code>secretWall.gtmpl</code> to update the href of the link and let <strong>Juzu manage it</strong>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="html language-html"><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@{JuZcretApplication.addSecretForm()}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">button</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Share my secret<span class="tag">&lt;/a&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Controller URL</strong> are natively supported in template. So if you change the Route of your view, you don&#8217;t need to update your template, Juzu take care of this.</p>
</div>

</div>
</div>
<div class="sect1">
<h2 id="_action"><a class="anchor" href="#_action"></a>Action</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Juzu, the logic of the application processing is implemented via <strong>Action Controller</strong>. Action Controller are method annotated with <code>@Action</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create in <code>JuZcretApplication.java</code> our first action controller responsible of the <strong>creation of new secret</strong>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">juzu.Action</span>;

...

   <span class="annotation">@Action</span>
   <span class="directive">public</span> Response.View addSecret(<span class="predefined-type">String</span> msg, <span class="predefined-type">String</span> imgURL) {
        secretService.addSecret(msg, imgURL);
       <span class="keyword">return</span> JuZcretApplication_.index();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now come back to <code>addSecret.gtmpl</code> to update the submit action of the form:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="html language-html"><span class="tag">&lt;form</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@{JuZcretApplication.addSecret()}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h5&gt;</span>Share my secret<span class="tag">&lt;/h5&gt;</span>
...
<span class="tag">&lt;/form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now rebuild our project, then refresh browser, and click on the <em>Share my secret</em> link to add  a new secret:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/step2/secret-form-step-2.png" alt="Secret form" width="800">
</div>

</div>

</div>
</div>

<h1 id="_redirection" class="sect0"><a class="anchor" href="#_redirection"></a>Redirection</h1>
<div class="paragraph">
<p><strong>An action never produces markup</strong>, instead an action phase is followed by a <strong>view</strong> phase that will <strong>return a markup response</strong>. Juzu handles this interaction with an http redirection to the next view phase via the <strong>redirect after post</strong> pattern.<br>
What&#8217;s <code>JuZcretApplication_</code> ? It&#8217;s a class generated by Juzu via Annotation of <code>JuZcretApplication</code>.<br>
It&#8217;s the <strong>companion class</strong> of <strong>JuZcretApplication</strong> generated by Juzu during the compilation of the project. In Juzu any controller class generates a companion class. The companion class has the <strong>same name</strong> than the original class appended <strong>with the _ character</strong>.</p>
</div>
<div class="paragraph">
<p>So after adding the new secret you are <strong>automatically redirected to the Secret Wall</strong> page:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/step2/new-secret-added-step2.png" alt="New secret added" width="800">
</div>

</div>
<div class="paragraph">
<p>At this step we don&#8217;t need anymore of the <code>Controller.java</code> and the <code>index.gtmpl</code>. You can remove both. Your project must look like:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/step2/structure-project-end-step-2.png" alt="Structure project" width="300">
</div>

</div>
<div class="paragraph">
<p>We now have some <strong>interesting features</strong> allowing to interact with our Juzu Portlet but still a ugly design. It&#8217;s time for <a href="./step3.html"><strong>improving the UI</strong> of JuZcret to attract many secret users&#8230;</a></p>
</div>
<script type="text/javascript">
//Get the left menu
var leftmenu = document.getElementsByClassName("sectlevel0")[0];

//Create back to menu link
var menuLink = document.createElement("a");
menuLink.href = "./index.html";
menuLink.appendChild(document.createTextNode("Menu"));
var menu = document.createElement("li");
menu.setAttribute("class", "menuStep");
menu.appendChild(menuLink);

//Create go to previous step link
var previousStepLink = document.createElement("a");
previousStepLink.href = "./step1.html";
previousStepLink.appendChild(document.createTextNode("Back to previous Step"));
var previousStep = document.createElement("li");
previousStep.setAttribute("class", "previousStep");
previousStep.appendChild(previousStepLink);

//Create go to next step link
var nextStepLink = document.createElement("a");
nextStepLink.href = "./step3.html";
nextStepLink.appendChild(document.createTextNode("Go to next Step"));
var nextStep = document.createElement("li");
nextStep.setAttribute("class", "nextStep");
nextStep.appendChild(nextStepLink);

//Add them to Left Menu
leftmenu.insertBefore(previousStep, leftmenu.firstChild);
leftmenu.insertBefore(menu, leftmenu.firstChild);
leftmenu.appendChild(nextStep);
</script>

</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-04-24 14:06:58 CEST
</div>
</div>
</body>
</html>