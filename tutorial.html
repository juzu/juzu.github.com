
<!DOCTYPE html
  SYSTEM "">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Juzu Web Framework 0.4.5-SNAPSHOT</title><link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><script src="js/bootstrap/jquery-1.7.1.min.js"></script><script src="js/bootstrap/bootstrap-2.0.2.min.js"></script><script src="js/bootstrap/docbook.js"></script><script src="js/bootstrap/google-code-prettify/prettify.js"></script></head><body onload="if (prettyPrint) { prettyPrint() }"><div class="book container" title="Juzu Web Framework 0.4.5-SNAPSHOT"><div class="titlepage"><div><div><h1 class="title"><a name="UTF-8"></a>Juzu Web Framework 0.4.5-SNAPSHOT</h1></div><div><h2 class="subtitle">Tutorial</h2></div><div><div class="authorgroup">
    <div class="author"><h3 class="author"><span class="firstname">Julien</span> <span class="surname">Viet</span></h3><div class="affiliation">
        <span class="shortaffil">eXo Platform<br></span>
      </div></div>
  </div></div><div><p class="copyright">Copyright &copy; 2011 eXo Platform SAS</p></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="preface"><a href="#d5e18">Preface</a></span></dt><dt><span class="chapter"><a href="#quickstart">1. Quickstart </a></span></dt><dd><dl><dt><span class="section"><a href="#d5e26">Deploy the applications</a></span></dt><dt><span class="section"><a href="#d5e62">Interacting with the application</a></span></dt></dl></dd><dt><span class="chapter"><a href="#template_overview">2. Template overwiew </a></span></dt><dt><span class="chapter"><a href="#dependency_injection">3. Dependency Injection </a></span></dt><dt><span class="chapter"><a href="#views">4. Views </a></span></dt><dt><span class="chapter"><a href="#actions">5. Actions </a></span></dt><dt><span class="chapter"><a href="#type_safe_templating">6. Type safe templating </a></span></dt><dt><span class="chapter"><a href="#preferences">7. Using portlet preferences </a></span></dt><dd><dl><dt><span class="section"><a href="#d5e249">Reading preferences</a></span></dt><dt><span class="section"><a href="#d5e259">Writing preferences</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d5e273">8. Wrap up</a></span></dt></dl></div>
  
  <div class="preface" title="Preface"><div class="titlepage"><div><div><div xmlns:d="http://docbook.org/ns/docbook" class="page-header"><h1><a name="d5e18"></a>Preface</h1></div></div></div></div>
    
    <p>Juzu is a web framework based on MVC concepts for developing Portlet applications. Juzu is an open source project developed on GitHub <a class="ulink" href="https://github.com/juzu/juzu" target="_top">project</a> licensed under the <a class="ulink" href="http://www.gnu.org/licenses/lgpl-2.1.html" target="_top">LGPL 2.1</a> license.</p>
    <p>This tutorial will make you familliar with Juzu, to reach our objective we will develop a weather application in several steps, each step introducing a new feature to gradually improve the application.</p>
  </div>
  <div class="chapter" title="Chapter&nbsp;1.&nbsp;Quickstart"><div class="titlepage"><div><div><div xmlns:d="http://docbook.org/ns/docbook" class="page-header"><h1><a name="quickstart"></a>Chapter&nbsp;1.&nbsp;Quickstart </h1></div></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d5e26">Deploy the applications</a></span></dt><dt><span class="section"><a href="#d5e62">Interacting with the application</a></span></dt></dl></div>
    
    <div class="section" title="Deploy the applications"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e26"></a>Deploy the applications</h2></div></div></div>
      
      <p>Before diving in the technical part of this tutorial, we need to study how to deploy the examples and how to use them. In the package you downloaded you will find a war file adapted to your portal server in the <code class="code">/tutorial</code> directory:</p>
      <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <p>
            <code class="code">juzu-tutorial-examples-gatein.war</code> for the GateIn portal server</p>
        </li><li class="listitem">
          <p>
            <code class="code">juzu-tutorial-examples-liferay.war</code> for the Liferay portal server</p>
        </li></ul></div>
      <p>The main reason we have two servers is that the jars are not exactly the same, each is adapted to the portal server you will use. When you deploy the applications, the deployment process will print information in the console, similar to:</p>
      <pre class="screen">INFO: Deploying web application archive juzu-tutorial-gatein.war
[Weather4Portlet] Building application
[Weather4Portlet] Using injection org.juzu.impl.spi.inject.cdi.CDIBootstrap
[Weather4Portlet] Starting Weather4Application
[Weather4Portlet] Dev mode scanner monitoring /java/gatein/webapps/juzu-tutorial-gatein/WEB-INF/src
[Weather3Portlet] Building application
[Weather3Portlet] Using injection org.juzu.impl.spi.inject.spring.SpringBootstrap
[Weather3Portlet] Starting Weather3Application
[Weather3Portlet] Dev mode scanner monitoring /java/gatein/webapps/juzu-tutorial-gatein/WEB-INF/src
[Weather5Portlet] Building application
[Weather5Portlet] Using injection org.juzu.impl.spi.inject.cdi.CDIBootstrap
[Weather5Portlet] Starting Weather5Application
[Weather5Portlet] Dev mode scanner monitoring /java/gatein/webapps/juzu-tutorial-gatein/WEB-INF/src
[Weather2Portlet] Building application
[Weather2Portlet] Using injection org.juzu.impl.spi.inject.cdi.CDIBootstrap
[Weather2Portlet] Starting Weather2Application
[Weather2Portlet] Dev mode scanner monitoring /java/gatein/webapps/juzu-tutorial-gatein/WEB-INF/src
[Weather1Portlet] Building application
[Weather1Portlet] Using injection org.juzu.impl.spi.inject.cdi.CDIBootstrap
[Weather1Portlet] Starting Weather1Application
[Weather1Portlet] Dev mode scanner monitoring /java/gatein/webapps/juzu-tutorial-gatein/WEB-INF/src</pre>
      <p>As we can notice, there are 5 applications deployed, one for each of the topic of this tutorial</p>
      <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <p>Weather1Application: <a class="xref" href="#quickstart" title="Chapter&nbsp;1.&nbsp;Quickstart">Chapter&nbsp;1, <i>Quickstart </i></a>
          </p>
        </li><li class="listitem">
          <p>Weather2Application: <a class="xref" href="#template_overview" title="Chapter&nbsp;2.&nbsp;Template overwiew">Chapter&nbsp;2, <i>Template overwiew </i></a>
          </p>
        </li><li class="listitem">
          <p>Weather3Application: <a class="xref" href="#dependency_injection" title="Chapter&nbsp;3.&nbsp;Dependency Injection">Chapter&nbsp;3, <i>Dependency Injection </i></a>
          </p>
        </li><li class="listitem">
          <p>Weather4Application: <a class="xref" href="#views" title="Chapter&nbsp;4.&nbsp;Views">Chapter&nbsp;4, <i>Views </i></a>
          </p>
        </li><li class="listitem">
          <p>Weather5Application: <a class="xref" href="#actions" title="Chapter&nbsp;5.&nbsp;Actions">Chapter&nbsp;5, <i>Actions </i></a>
          </p>
        </li><li class="listitem">
          <p>Weather6Application: <a class="xref" href="#type_safe_templating" title="Chapter&nbsp;6.&nbsp;Type safe templating">Chapter&nbsp;6, <i>Type safe templating </i></a>
          </p>
        </li><li class="listitem">
          <p>Weather7Application: <a class="xref" href="#preferences" title="Chapter&nbsp;7.&nbsp;Using portlet preferences">Chapter&nbsp;7, <i>Using portlet preferences </i></a>
          </p>
        </li></ul></div>
    </div>
    <div class="section" title="Interacting with the application"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e62"></a>Interacting with the application</h2></div></div></div>
      
      <p>In this tutorial, Juzu applications are deployed in the <span class="bold"><strong>
          <span class="italic">dev</span>
        </strong></span> mode. This runtime mode allows you to modify the source code of the application, Juzu will pick up the modifications and update the running application almost instantanesouly.</p>
      <p>The source code for the five applications is in the <code class="code">/WEB-INF/src</code> directory of the war file, each application has its own package, for instance the quickstart application uses the package <code class="code">examples.tutorial.weather1</code>. The first version of the application shows the most basic Juzu application. Our application is declared in the <code class="code">examples.tutorial.weather1</code> package package annotated with the <code class="code">@Application</code> annotation This annotation declares a Juzu application and does not require any mandatory value. Like classes, methods or fields, Java packages can be annotated, such packages declaration are represented by a special file named <code class="code">package-info.java</code>.</p>
      <p>Usually an application is made of controllers and templates, in this example, the <code class="code">Weather</code> Java class contains a method annotated with the <code class="code">@View</code> annotation, which turns the <code class="code">Weather</code> class into a Juzu controller. The controller method <code class="code">index()</code> is the name of the default method that Juzu will call.</p>
      <div class="programlistingco"><pre class="prettyprint language-java">   @View
   public void index()
   {
      index.render();
   }</pre></div>
      <p>Methods annotated by <code class="code">@View</code> have the unique purpose of providing markup, they are called <span class="italic">view</span>. In our case, the method delegates the rendering to the <code class="code">index.gtmpl</code> template. The template is injected in the controller thanks to the <code class="code">@Inject</code> annotation and the <code class="code">@Path("index.gtmpl")</code> annotation.</p>
      <div class="programlistingco"><pre class="prettyprint language-java">   @Inject
   @Path("index.gtmpl")
   Template index;</pre></div>
      <p>By default templates are located in the <code class="code">templates</code> package of the application, in our case the <code class="code">examples.tutorial.weather1.templates</code> package. The <code class="code">@Path</code> annotation specifies the path of the template in this package. The templates are located in the same source tree than the java classes because the files must be available for the Java compiler.</p>
    </div>
  </div>
  <div class="chapter" title="Chapter&nbsp;2.&nbsp;Template overwiew"><div class="titlepage"><div><div><div xmlns:d="http://docbook.org/ns/docbook" class="page-header"><h1><a name="template_overview"></a>Chapter&nbsp;2.&nbsp;Template overwiew </h1></div></div></div></div>
    
    <p>Now we will improve our application by exploring a bit the templating engine.  We will show a quick overview of Juzu templating system. Templates are essentially made of static part (usually markup) and dynamic parts. In this section we will focus on explaining the use of dynamic expression in a template.</p>
    <p>The application shows how a view can provide variable input for a dynamic template with parameters. Our application has  a view controller and a template, but now the template contains the <code class="code">${ }</code> expression that makes it dynamic.</p>
    <div class="programlistingco"><pre class="prettyprint">The weather temperature in ${location} is ${temperature} degrees.</pre></div>
    <p>Like before the template is used in the view controller but now we use a <code class="code">Map</code> containing the <code class="code">location</code> and <code class="code">temperature</code> parameters.</p>
    <div class="programlistingco"><pre class="prettyprint language-java">   @View
   public void index()
   {
      Map&lt;String, Object&gt; parameters = new HashMap&lt;String, Object&gt;();
      parameters.put("location", "Marseille");
      parameters.put("temperature", "20");
      index.render(parameters);
   }</pre></div>
    <p>During the template rendering, the <code class="code">location</code> and <code class="code">temperature</code> expressions are resolved to the value provided by the view controller. When a template is rendered, an optional map can be provided, this map will be available during the rendering of the template for resolving expression.</p>
  </div>
  <div class="chapter" title="Chapter&nbsp;3.&nbsp;Dependency Injection"><div class="titlepage"><div><div><div xmlns:d="http://docbook.org/ns/docbook" class="page-header"><h1><a name="dependency_injection"></a>Chapter&nbsp;3.&nbsp;Dependency Injection </h1></div></div></div></div>
    
    <p>The next step is to make our application obtain real data instead of the hardcoded values we used in the previous section. For this matter we use a remote service that we encapsulate into the <code class="code">WeatherService</code>.</p>
    <div class="programlistingco"><pre class="prettyprint language-java">public class WeatherService
{

   public String getTemperature(String location)
   {
      return getTemperature(location, "c");
   }

   public String getTemperature(String location, String grade)
   {
      try
      {
         XPath xpath = XPathFactory.newInstance().newXPath();
         XPathExpression expr = xpath.compile("//temp_" + grade + "/@data");
         String url = "http://www.google.com/ig/api?weather=" + location;
         InputSource src = new InputSource(url);
         src.setEncoding("ISO-8859-1");
         return expr.evaluate(src);
      }
      catch (XPathExpressionException e)
      {
         return "unavailable";
      }
   }
}</pre></div>
    <p>Juzu uses dependency injection to interact with a service layer. The <a class="ulink" href="http://jcp.org/en/jsr/detail?id=330" target="_top">JSR-330</a>,  also knowns as <code class="code">@Inject</code>, defines an API for dependency injection. The <code class="code">WeatherService</code> is injected in the  controller with the <code class="code">weatherService</code> field annotated with the <code class="code">@Inject</code> annotation:</p>
    <div class="programlistingco"><pre class="prettyprint language-java">   @Inject
   WeatherService weatherService;</pre></div>
    <p>This service is then simply used into our controller <code class="code">index()</code> method:</p>
    <div class="programlistingco"><pre class="prettyprint language-java">   @View
   public void index()
   {
      Map&lt;String, Object&gt; parameters = new HashMap&lt;String, Object&gt;();
      parameters.put("location", "Marseille");
      parameters.put("temperature", weatherService.getTemperature("marseille"));
      index.render(parameters);
   }</pre></div>
    <p>As we can see, Juzu relies on the portable <code class="code">@Inject</code> annotation to declare sinjections. Injection is performed by the dependency injection container. At the moment the following containers are supported:</p>
    <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
        <p>
          <a class="ulink" href="http://www.springsource.org/" target="_top">Spring Framework</a>
        </p>
      </li><li class="listitem">
        <p>
          <a class="ulink" href="http://seamframework.org/Weld" target="_top">JBoss Weld</a>
        </p>
      </li></ul></div>
    <p>There is a preliminary support for <a class="ulink" href="http://code.google.com/p/google-guice/wiki/Guice30" target="_top">Google Guice 3.0</a>, but it is not yet available. In the future more container support could be achieved.</p>
    <p>By default it uses the <span class="italic">Weld</span> container, if you want instead to use <span class="italic">Spring</span> container instead the configuration is done by a portlet init param defined in the deployment descriptor of the portlet:</p>
    <div class="programlistingco"><pre class="prettyprint language-xml">&lt;init-param&gt;
  &lt;name&gt;juzu.inject&lt;/name&gt;
  &lt;value&gt;spring&lt;/value&gt;
&lt;/init-param&gt;
</pre></div>
    <p>In the case of <span class="italic">Spring</span>, the file <code class="code">spring.xml</code> file is needed, it contains the service declarations for the Spring container.</p>
    <p>Juzu provides more advanced dependency injection, in particular it uses the <code class="code">Qualifier</code> and <code class="code">Scope</code> features defined   by the JSR-330 specification that will be studied later.</p>
  </div>
  <div class="chapter" title="Chapter&nbsp;4.&nbsp;Views"><div class="titlepage"><div><div><div xmlns:d="http://docbook.org/ns/docbook" class="page-header"><h1><a name="views"></a>Chapter&nbsp;4.&nbsp;Views </h1></div></div></div></div>
    
    <p>Until now we have seen a basic view controller, in this section we will study more in depth view controllers. A view controller is invoked by Juzu when the application needs to be rendered, which can happen anytime during the lifecycle of an application.</p>
    <p>This version has still the <code class="code">index()</code> view controller, but now it has also an overloaded <code class="code">index(String location)</code> method that accept a <code class="code">location</code> argument as a view parameter.</p>
    <div class="programlistingco"><pre class="prettyprint language-java">   @View
   public void index(String location)
   {
      Map&lt;String, Object&gt; parameters = new HashMap&lt;String, Object&gt;();
      parameters.put("location", location);
      parameters.put("temperature", weatherService.getTemperature("marseille"));
      index.render(parameters);
   }</pre></div>
    <p>View parameters are bound to the current navigation of the application and their value are managed by the framework. At this point it is normal to wonder how a view parameter value can change. Let's have a closer look at the <code class="code">index.gtmpl</code> application template.</p>
    <div class="programlistingco"><pre class="prettyprint">The weather temperature in ${location} is ${temperature} degrees.
&lt;a href="@{index(location = 'marseille')}"&gt;Marseille&lt;/a&gt;
&lt;a href="@{index(location = 'paris')}"&gt;Paris&lt;/a&gt;
</pre></div>
    <p>The template now has two links that change the view parameters when they are processed. The links are created by a special syntax that references the view method, for instance the script fragment <code class="code">@{index(location = 'paris')}</code> generates an url that updates the <code class="code">location</code> view parameter to the <code class="code">paris</code> value when it is processed.</p>
    <p>The initial controller method <code class="code">index()</code> is still there but now it simply invokes the <code class="code">index(String location)</code> controller with a predefined value.</p>
    <div class="programlistingco"><pre class="prettyprint language-java">   @View
   public void index()
   {
      index("marseille");
   }</pre></div>
    <p>We could't close this section without talking a bit about <span class="bold"><strong>safe urls</strong></span>. Juzu is deeply integrated at the heart of the Java compiler and performs many checks to detect applications bugs during the application compilation. Among those checks, templates are validated and the url syntax <code class="code">@{ }</code> is checked against the application controllers. In fact Juzu will resolve an url syntax until it finds one controller that resolves the specified name and parameters. If not Juzu will make the compilation fail and give detailled information about the error. This kind of feature makes Juzu really unique among all other web frameworks, we will see some other later.</p>
    <div class="alert alert-success alert-block" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
      <p>Juzu leverages the <a class="ulink" href="http://download.oracle.com/javase/6/docs/technotes/guides/apt/index.html" target="_top">Annotation Processing Tool</a> (APT) facility standardized since Java 6. APT works with any Java compiler and is not specific to a build system or IDE, it just works anywhere, we will see later that it even works with Eclipse incremental compiler.</p>
    </div>
  </div>
  <div class="chapter" title="Chapter&nbsp;5.&nbsp;Actions"><div class="titlepage"><div><div><div xmlns:d="http://docbook.org/ns/docbook" class="page-header"><h1><a name="actions"></a>Chapter&nbsp;5.&nbsp;Actions </h1></div></div></div></div>
    
    <p>Now it's time to introduce action controllers, actions are method annotated by the <code class="code">@Action</code> annotation. Unlike views, actions are only called when an action url is processed by the portal, whereas a view controller method can be invoked any time by the portal.</p>
    <p>The role of an action controller is to process actions parameters. Each parameter of an action controller method is mapped to the incoming request processed by the portal, such parameters can be encoded directly in the URL or be present in the form that triggers the action.</p>
    <div class="programlistingco"><pre class="prettyprint">The weather temperature in ${location} is ${temperature} degrees.

&lt;ul&gt;&lt;% locations.each() { location -&gt; %&gt;
&lt;li&gt;&lt;a href="@{index(location = location)}"&gt;${location}&lt;/a&gt;&lt;/li&gt;
&lt;% } %&gt;
&lt;/ul&gt;

&lt;form action="@{add()}" method="post"&gt;
   &lt;input type="text" name="location" value=""/&gt;
   &lt;input type="submit"/&gt;
&lt;/form&gt;</pre></div>
    <p>In our example, we use a form which contains the the #location# action parameters. In order to create an action url we use the same syntax shown for view url <code class="code">@{add()}</code> but this time we don't need to set any parameter, instead the form parameters will be used when the form is submitted. However this is not mandatory and instead we could have url parameters such as <code class="code">@{add(location = 'washington'}</code>, such syntax is valid specially when it is used without a form. Obviously there is the possibility to mix form and action parameters.</p>
    <p>When the url is processed, the following action controller method will be invoked:</p>
    <div class="programlistingco"><pre class="prettyprint language-java">   @Action
   public Response add(String location)
   {
      locations.add(location);
      return Weather_.index(location);
   }</pre></div>
    <p>The method process the <code class="code">location</code> parameter and add it to the <code class="code">locations</code> set. After this the portal will proceed to the page rendering phase and will call the <code class="code">index()</code> method to refresh the application.</p>
  </div>
  <div class="chapter" title="Chapter&nbsp;6.&nbsp;Type safe templating"><div class="titlepage"><div><div><div xmlns:d="http://docbook.org/ns/docbook" class="page-header"><h1><a name="type_safe_templating"></a>Chapter&nbsp;6.&nbsp;Type safe templating </h1></div></div></div></div>
    
    <p>We have seen previously how render templates from a controller by passing them parameters. Templates use <code class="code">${ }</code> expressions that often refers to parameters passed by the controller when it renders the template. For this purpose we used an <code class="code">HashMap</code> in which we put the various parameters that the template will use during rendering.</p>
    <p>This syntax is a generic way to do by using an untyped syntax, indeed if a template parameter name changes the controller will continue to compile because of the generic parameter map.  To improve this situation, parameters can be declared thanks to a <code class="code">param</code> tag inside the template:</p>
    <div class="programlistingco"><pre class="prettyprint">#{param name=location/}
#{param name=temperature/}
#{param name=locations/}

The weather temperature in ${location} is ${temperature} degrees.

&lt;ul&gt;&lt;% locations.each() { location -&gt; %&gt;
&lt;li&gt;&lt;a href="@{index(location = location)}"&gt;${location}&lt;/a&gt;&lt;/li&gt;
&lt;% } %&gt;
&lt;/ul&gt;

&lt;form action="@{add()}" method="post"&gt;
   &lt;input type="text" name="location" value=""/&gt;
   &lt;input type="submit"/&gt;
&lt;/form&gt;</pre></div>
    <p>For instance the <code class="code">location</code> parameter is declared by the <code class="code">#{param name=location/}</code> tag. During the Java compilation, Juzu leverage those parameter declarations to provide a more convenient way to render a template.</p>
    <p>Indeed the tight integration with the Java compiler allows Juzu to generate a template class for each template of the application, such template class inherits the <code class="code">Template</code> class and adds specific methods for passing parameters to a template in a safe manner.</p>
    <div class="programlistingco"><pre class="prettyprint language-java">   @View
   public void index(String location)
   {
      index.
         with().
         location(location).
         temperature(weatherService.getTemperature(location)).
         locations(locations).
         render();
   }</pre></div>
    <p>As we can see, the <code class="code">HashMap</code> is not used anymore and now we use a type safe and compact expression for rendering the template. Each declared parameter generates a method named by the parameter name, for the <code class="code">location</code> parameter, we do have now a <code class="code">location(String location)</code> method that can be used. To make the syntax fluent, the parameter methods can be chained, finally the <code class="code">render()</code> method is invoked to render the template, however it does not require any parameter since all parameters where passed thanks to the parameter methods.</p>
    <p>The Java name of the generated template class is the name of the template in the <code class="code">templates</code> package of the application. In our case we do obtain the <code class="code">examples.tutorial.weather6.templates.index</code> class name. It is very easy to use our subclass by injecting the template subclass instead of the generic <code class="code">Template</code> class.</p>
    <div class="programlistingco"><pre class="prettyprint language-java">   @Inject
   @Path("index.gtmpl")
   examples.tutorial.weather6.templates.index index;</pre></div>
    <p>Of course it is possible to import this value and use directly the <code class="code">index</code> class name. We used directly the full qualified name of the class for the sake of the clarity.</p>
  </div>
  <div class="chapter" title="Chapter&nbsp;7.&nbsp;Using portlet preferences"><div class="titlepage"><div><div><div xmlns:d="http://docbook.org/ns/docbook" class="page-header"><h1><a name="preferences"></a>Chapter&nbsp;7.&nbsp;Using portlet preferences </h1></div></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d5e249">Reading preferences</a></span></dt><dt><span class="section"><a href="#d5e259">Writing preferences</a></span></dt></dl></div>
    
    <p>A portlet provides a <code class="code">PortletPreferences</code> object for loading and saveing user preferences, it is a collection of key and values of type string, very much like a map. Juzu does not wrap the preferences object, instead it can be injected via the <code class="code">@Inject</code> annotation:</p>
    <div class="programlistingco"><pre class="prettyprint language-java">   @Inject
   PortletPreferences preferences;</pre></div>
    <p>The preferences object is available during the various phases of the application and can be used to retrieve and store user preferences, but keep in mind that storing preferences can only be done an action phase.</p>
    <div class="alert alert-success alert-block" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
      <p>The preferences object is bound in the IOC container with the request scope, since the validity of the preferences object is associated with a portlet request. There is no need to declared the request scope in the preferences injection.</p>
    </div>
    <div class="section" title="Reading preferences"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e249"></a>Reading preferences</h2></div></div></div>
      
      <p>To use the preferences in the templates we have modified the template to contain an additional <code class="code">grade</code> parameter that will be configured by the <code class="code">index</code> method when it renders the template. The grade value is obtained from the <code class="code">preferences</code> field at the beginning of the <code class="code">index</code> method:</p>
      <div class="programlistingco"><pre class="prettyprint language-java">   @View
   public void index(String location)
   {
      String grade = preferences.getValue("grade", "c");
      index.
         with().
         location(location).
         temperature(weatherService.getTemperature(location, grade)).
         grade(grade).
         locations(locations).
         render();
   }</pre></div>
    </div>
    <div class="section" title="Writing preferences"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e259"></a>Writing preferences</h2></div></div></div>
      
      <p>Preferences can be updated during the action phase of the application. The action phase is triggered by a form in the template:</p>
      <div class="programlistingco"><pre class="prettyprint">#{param name=location/}
#{param name=temperature/}
#{param name=locations/}
#{param name=grade/}

&lt;form style="float:right" action="@{updateGrade()}" method="post"&gt;
    &lt;select name="grade" onChange="javascript:this.form.submit();"&gt;
        &lt;option value="c" &lt;%=grade=='c'?'selected':''%&gt;&gt;celsius&lt;/option&gt;
        &lt;option value="f" &lt;%=grade=='f'?'selected':''%&gt;&gt;fahrenheit&lt;/option&gt;
    &lt;/select&gt;
&lt;/form&gt;

The weather temperature in ${location} is ${temperature} degrees.

&lt;ul&gt;&lt;% locations.each() { location -&gt; %&gt;
    &lt;li&gt;&lt;a href="@{index(location = location)}"&gt;${location}&lt;/a&gt;&lt;/li&gt;
    &lt;% } %&gt;
&lt;/ul&gt;

&lt;form action="@{add()}" method="post"&gt;
    &lt;input type="text" name="location" value=""/&gt;
    &lt;input type="submit"/&gt;
&lt;/form&gt;</pre></div>
      <p>The form action value is set to <code class="code">@{updateGrade()}</code> URL that will invoke the corresponding method in the controller:</p>
      <div class="programlistingco"><pre class="prettyprint language-java">   @Action
   public void updateGrade(String grade) throws java.io.IOException,
      javax.portlet.PortletException
   {
      preferences.setValue("grade", grade);
      preferences.store();
   }</pre></div>
      <p>The <code class="code">updateGrade</code> action updates the preferences and then invoke the <code class="code">store()</code> method to persist the changes.</p>
    </div>
  </div>
  <div class="chapter" title="Chapter&nbsp;8.&nbsp;Wrap up"><div class="titlepage"><div><div><div xmlns:d="http://docbook.org/ns/docbook" class="page-header"><h1><a name="d5e273"></a>Chapter&nbsp;8.&nbsp;Wrap up</h1></div></div></div></div>
    
    <p>We reached the ends our walk through Juzu, now you can learn more and study the Booking application. This application can be found in the package you downloaded in the <code class="code">booking</code> directory.</p>
  </div>
</div></body></html>